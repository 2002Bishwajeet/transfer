<?php

use PHPUnit\Framework\TestCase;
use Utopia\Transfer\Destination;
use Utopia\Transfer\Source;
use Utopia\Transfer\Transfer;

class ProviderTest extends TestCase
{
    /**
     * @var Destination|Source
     */
    public $provider;

    public function testValidateProviders()
    {
        $this->assertIsObject($this->provider);
        $this->assertNotEmpty($this->provider->getSupportedResources());
    }
    
    public function testexportAuth()
    {
        $result = [];

        $this->provider->exportAuth(100, function (array $users) use (&$result) {
            $result = array_merge($result, $users);
        });

        foreach ($result as $user) {
            /** @var User $user */
            $this->assertIsObject($user);
        }

        $this->assertIsArray($result);
        $this->assertNotEmpty($result);
    }

    public function testExportDatabases()
    {
        $result = [];

        $this->provider->exportDatabases(100, function (array $databases) use (&$result) {
            $result = array_merge($result, $databases);
        });

        foreach ($result as $database) {
            /** @var Database $database */
            $this->assertIsObject($database);
            $this->assertNotEmpty($database->getCollections());
        }

        $this->assertIsArray($result);
        $this->assertNotEmpty($result);
    }

    public function testCheckUsers()
    {
        $result = $this->provider->check([Transfer::GROUP_AUTH]);

        $this->assertEquals($result, [Transfer::GROUP_AUTH]);
    }

    public function testCheckDatabases()
    {
        $result = $this->provider->check([Transfer::GROUP_DATABASES]);

        $this->assertEquals($result, [Transfer::GROUP_DATABASES]);
    }
}